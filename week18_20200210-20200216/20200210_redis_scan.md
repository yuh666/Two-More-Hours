## scan命令

1. keys的缺点

   - 当key的数量过多时,通过keys操作需要遍历整个redisServer对应db的字典表的所有key,当key较多时会导致主线程不能去执行其他的命令请求即阻塞
   - 没有提供offset和limit的参数

2. scan在redis 2.8版本之后引入

   - 提供offset和limit参数,每次可以查询指定数量的key offset和limit指的是hash表对应的数组的下标当scan结果返回为0时遍历完成
   - 通过游标来分步执行不会阻塞主线程
   - 采用高位累加遍历的算法,防止当redis 字典进行rehash时遍历到重复的内容(当扩容时不会重复,当缩容时会重复)
   - 游标遍历过程中,对key新的赋值不一定能遍历到

3. scan命令

   ```java
   scan cursor [MATCH pattern] [COUNT count]
   -- 参数1 cursor:游标的起始值 即开始遍历的数组下标 从0开始
   -- 参数2 pattern:匹配key的表达式 当条件满足表达式后才会返回对应key的结果
   -- 参数3 count:访问下标的数量,比如 cursor 0 count 2 即至少返回hash表的两个下标,如果当链表为0时会访问2+个
   -- 返回结果:游标下次遍历开始的起始值,当结果返回为0时遍历完成
   ```

4. 高位累加遍历

5. ![image-20200211100311446](https://note.youdao.com/yws/public/resource/0913f7b1edd0a739cddfc0fb16cfac5b/xmlnote/5132790D086A449787EE3FCAC561D6C1/9145)

6. 比如当前遍历到 110即数组下标为6的位置时,如果出现扩容数组从容量16变为32此时6的位置可能变为6和22即0110和1110  0110和1110在高位累加中是紧挨着的此时说明0110之前的元素时遍历过的从0110遍历即可,不会对之前的元素重复遍历;同时当缩容时,110变为10此时从10开始遍历可能会出现重复的内容因为10对于010和110缩容的值,010已遍历过此时需要客户端来进行scan结果的去重工作

