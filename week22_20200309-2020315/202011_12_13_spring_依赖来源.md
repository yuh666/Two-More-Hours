## 依赖查找来源

1. spring bean Definition对象,比如通过xml定义 @bean BeanDefinitionBuilder方式被BeanDefinitionRegistry注册对象
2. 单例对象,通过DefaultSingletonBeanRegistry来注册单例对象registerSingleton()



## 依赖查找来源:内建spring Bean Definition对象

| bean名称                                 | bean实例                             | 使用场景                                |
| ---------------------------------------- | ------------------------------------ | --------------------------------------- |
| internalConfigurationAnnotationProcessor | ConfigurationClassPostProcessor      | 处理spring配置类,比如@Configuration修饰 |
| internalAutowiredAnnotationProcessor     | AutowiredAnnotationBeanPostProcessor | 处理@Autowire和@value注解               |
| internalCommonAnnotationProcessor        | CommonAnnotationBeanPostProcessor    | 处理@PostConstruct                      |
| internalEventListenerProcessor           | EventListenerMethodProcessor         | 处理@EventListener注解                  |



## 依赖查找来源:内建单例对象

| bean名称                    | bean实例                                  | 使用场景                      |
| --------------------------- | ----------------------------------------- | ----------------------------- |
| environment                 | Environment                               | 外部化配置以及profiles        |
| systemProperties            | java.util.properties                      | java系统属性                  |
| systemEnvironment           | java.util.Map                             | 系统环境变量                  |
| messageSource               | org.springframework.context.MessageSource | 国际化文案                    |
| applicationEventMulticaster | ApplicationEventMulticaster               | Spring 事件广播器             |
| lifecycleProcessor          | LifecycleProcessor                        | LifecycleProcessor bean处理器 |



## 依赖注入的来源

1. spring Bean Definition对象,即自定义bean对象
2. 单例对象
3. resolveable Dependency:非spring管理的bean对象(比如BeanFactory ApplicationContext)



## spring Bean Definition来源特点

1. 元数据:BeanDefinition
2. 注册方式:BeanDefinitionRegistry#registryBeanDefinition
3. 延时加载@Lazy和非延迟
4. 顺序性:通过org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionNames维护



## 单例对象作为依赖来源

1. 来源:外部创建比如 new User()
2. 注册:通过SingletonBeanRegistry#registerSingleton()
3. 限制:无生命周期管理和无法延迟初始化



## 非spring管理对象作为依赖来源

1. 注册:DefaultListableBeanFactory#registerResolvableDependency()
2. 限制:无生命周期管理 不能通过依赖查找获取,无法实现延迟初始化bean
3. 在AbstractApplicationContext.refresh()#prepareBeanFactory阶段注册



## 外部化配置作为依赖来源

1. 类型:非spring对象依赖来源,比如@Value
2. 限制:无生命周期管理 无法延迟初始化 无法通过依赖查找



## 面试题一:spring的依赖查找和依赖注册来源相同吗

1. 不同
2. 依赖查找来源:spring bean Definition对象和单例对象
3. 依赖注册来源:在依赖查找基础上还多了非spring管理的对象resolveable dependency对象(比如beanFactory和ApplicationContext)和外部化配置对象通过@value方式注册



## 面试题二:spring依赖注入的来源

1. spring bean Definition对象,比如自定义@bean
2. 单例对象,比如Environment对象
3. resolveable Dependency对象 比如BeanFactory
4. 外部化配置对象@value 比如@Value("${user.name:xiaomage}")