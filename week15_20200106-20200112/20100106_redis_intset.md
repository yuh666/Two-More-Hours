## 整数集合

### 数据结构

1. 整数集合(intset)当集合中底层存储数据都是整数类型切无重复元素时使用

   ```redis
   sadd numbers 1 100 1001 111111
   ```

2. 数据存储分为三部分

   - encodeing:编码方式,每个元素的编码方式与其相同,例如:intset_enc_int16  32 64 对应的大小范围
   - length:集合中元素的个数
   - contents[]:存储元素的数组,元素存储按从小到大存储

## 升级

## ![image-20200106072028422](https://note.youdao.com/yws/public/resource/4762addbbb207565dafe6a1264ea04a1/xmlnote/00CD8707982F40759981583E849506F9/9008)

1. 当元素添加的值超过了旧的范围时进行升级,升级步骤
2. 根据新元素的类型,扩展整数集合数组的空间大小,比如添加65535是对应的类型为int32_t,32*4=128 之前存储3个元素为int16_t  3*16=48 所以分配的空间为 48-127
3. 将旧的元素的类型转为新的元素的类型,同时保证下标顺序一致 如图中3保持下标为2位置变为(64,95),同理1和2
4. 最后将添加的元素放入到数组的尾部,同时length+1

## 降级和元素存储

1. 为啥所有的元素不都存储int64_t,因为数据较小是会浪费内存的空间 需要合理的分配
2. 不支持降级操作