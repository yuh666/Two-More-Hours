## 单一类型查找接口-BeanFactory

1. 子接口:AutowireCapableBeanFactory
2. bean名称 beanFactory#getBean(string name)
3. bean类型查找
   - 实时查找: beanFactory#getBean(Class class)
   - 延时查找:beanFactory#getBeanProvider(Class)
4. bean名称和bean类型查找 beanFactory#getBean(String name,Class)



## 集合类型查找-ListableBeanFactory

1. 根据bean类型查找

   ```java
   org.springframework.beans.factory.ListableBeanFactory#getBeansOfType(java.lang.Class<T>)
   ```

2. 根据注解类型查找

   ```java
   org.springframework.beans.factory.ListableBeanFactory#getBeansWithAnnotation
   ```



## 层次类型查找HierarchicalBeanFactory

1. 子接口:ConfigurableBeanFactory 

2. 双亲beanFactory:org.springframework.beans.factory.HierarchicalBeanFactory#getParentBeanFactory

3. 根据bean名称查找

   ```java
   org.springframework.beans.factory.HierarchicalBeanFactory#containsLocalBean
   ```

4. bean类型查找

   - 单一类型

     ```java
     org.springframework.beans.factory.BeanFactoryUtils#beanOfType(org.springframework.beans.factory.ListableBeanFactory, java.lang.Class<T>)
     ```

   - 集合类型

     ```java
     org.springframework.beans.factory.BeanFactoryUtils#beanOfTypeIncludingAncestors(org.springframework.beans.factory.ListableBeanFactory, java.lang.Class<T>)
     ```

5. 注解类型查找

   ```java
   org.springframework.beans.factory.BeanFactoryUtils#beanNamesForTypeIncludingAncestors(org.springframework.beans.factory.ListableBeanFactory, java.lang.Class<?>)
   ```



## 延迟查找

```java
org.springframework.beans.factory.ObjectFactory#getObject
org.springframework.beans.factory.ObjectProvider#getIfAvailable()
```



## 安全类型和不安全类型查找

1. 单一类型
   - beanFactory#getBean 不安全
   - objectFactory#getObject 不安全
   - ObjectProvider#getIfAvailable()安全
2. 集合类型
   - listableBeanFactory#getBeansOfType() 安全
   - ObjectProvider#stream 安全



## 经典异常

1. bean不存在

   ```java
   org.springframework.beans.factory.NoSuchBeanDefinitionException
   ```

2. bean类型不只一个或者没声明Primary

   ```java
   org.springframework.beans.factory.NoUniqueBeanDefinitionException
   ```

3. bean初始化时失败,比如@PostConstruct中throw new exception

   ```java
   org.springframework.beans.factory.BeanCreationException
   ```

4. bean实例化异常,比如指定bean注册类型为接口类型

   ```java
   org.springframework.beans.BeanInstantiationException
   ```



## 面试题一:BeanFactory和ObjectFactory区别

1. objectFactory提供依赖查找的功能,底层也是通过beanFactory来查找bean,只具备一个或一种类型的查找
2. beanFactory的子类DefaultListableBeanFactory实现接口ConfigurableListableBeanFactory,ConfigurableListableBeanFactory接口继承ListableBeanFactory(集合类型),AutowireCapableBeanFactory(单一类型),ConfigurableBeanFactory(层级类型)



## 面试二:BeanFactory#getBean是否是线程安全

1. 在注册bean时,通过synchronized加锁的方式
2. 在获取bean时,通过ConcurrentHashMap获取