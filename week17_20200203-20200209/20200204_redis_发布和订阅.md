## 发布与订阅

1. 客户端通过subscribe订阅一个频道或多个频道的消息或者通过psubscribe命令订阅一个或多个模式来成为订阅者,当有其他客户端往该频道或模式上发送消息时,对应订阅的客户端则可接受到消息

2. ```java
   -- 频道的订阅
   subscribe "news.it"
   -- 模式的订阅
   psubscribe "news.[ie]t"
   -- 发布
   publish "news.it" "hello"
   
   ```



## 频道的订阅和退订

1. 频道的信息维护在redisServer的pubsub_channels属性中,数据类型dict
   - 键:频道的名称
   - 值:客户端的信息,订阅同一个频道的多个客户端链表相连
2. 当订阅频道信息时,首先通过dict获取key:频道名称的链表信息,如果为空则说明还未有客户端订阅,则在dict中创建key:频道信息 value:空链表,在将订阅该频道的客户端信息添加到链表中
3. 当某个频道订阅信息退订时,找到频道对应的链表信息,删除链表中指定的客户端信息,当链表为空后删除dict中该频道



## 模式的订阅和退订

1. 模式的订阅关系保存在redisServer的pubsub_patterns中,数据类型列表list
   - 链表中每个节点是一个pubsubPattern对象
   - 对象中包含客户端信息和模式pattern信息
2. 当订阅模式时,为该模式和客户端创建pubsubPattern对象,添加到pubsub_patterns链表的尾部
3. 退订订阅模式,遍历链表找到对应的pubsubPattern对象,删除该节点



## 消息发送

1. 发送消息给频道信息
   - 查找指定频道是否存在链表的客户端订阅者即在dict中是否存在频道key
   - 不存在直接返回,存在将消息发送给所有的订阅者
2. 发送消息给模式订阅者
   - 遍历模式订阅者的链表
   - 判断模式订阅者的模式是否与发送消息的频道匹配
   - 不匹配执行遍历下一个元素,匹配发送消息给该频道



## 查看订阅信息

1. 查看订阅频道信息

2. ```java
   pubsub channels [pattern]
   -- 不指定pattern,返回dict频道信息中所有订阅的频道信息
   pubsub channels
   -- 指定pattern,返回跟pattern匹配的频道信息
   pusub channels "news.[is]*"
   ```

3. 查看订阅者的数量

   ```java
   pubsub numsub [channel01 channel02 ...]
   pubsub numsub news.it
   ```

4. 返回订阅模式的数量:即list列表的长度

   ```java
   pubsub numpat
   ```

   

